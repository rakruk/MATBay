<!-- Contennt -->
<div *ngIf="!(isUserLoading || isConstitutionLoading)">
    <mat-sidenav-container class="sidenav">
        <div>
            <h4> {{constitution.name}} </h4>
            <span class="custom-br"></span>
            <div *ngIf="constitution.songs.length == 0"> Aucune chanson </div>
            <div *ngIf="constitution.songs.length == 1"> {{constitution.songs.length}} chanson </div>
            <div *ngIf="constitution.songs.length > 1"> {{constitution.songs.length}} chansons </div>
            Vous avez:
            {{numberOfSongsOfUser(currentUser.uid)}} / {{constitution.numberOfSongsPerUser}} chansons
            <br>
            <br>
            Membres :
            <div *ngFor="let user of users">
                <img class="picture" [src]="user.photoURL" [alt]="user.displayName"> {{user.displayName}}
                <br>
            </div>
            <span class="custom-br"></span>
            <br>
            <button mat-raised-button color="primary" (click)="openDialogManageSongs()"> Gérer mes chansons </button>
            <br>
            <br>
            <button mat-stroked-button color="warn" (click)="leaveConstitution()"> Quitter la constitution </button>
        </div>
    </mat-sidenav-container>
    
    <div class="content">
        <!-- Navbar -->
        <mdb-navbar SideClass="navbar navbar-expand-lg navbar-dark elegant-color-dark lighten-1" [containerInside]="false">
            <!-- Navbar brand -->
            <mdb-navbar-brand><a class="navbar-brand" routerLink="/"></a></mdb-navbar-brand>
            <links>
                <!-- Links -->
                <ul class="navbar-nav mr-auto">
                    <li [ngClass]="{'nav-item': true, 'active': currentSection === SelectionType.SongList}">
                        <button mat-button class="nav-link waves-light" (click)="changeCurrentSection(SelectionType.SongList)"> Liste Chansons </button>
                    </li>
                    <li [ngClass]="{'nav-item': true, 'active': currentSection === SelectionType.Vote}">
                        <button mat-button class="nav-link waves-light" (click)="changeCurrentSection(SelectionType.Vote)"> Zone Électorale </button>
                    </li>
                    <li [ngClass]="{'nav-item': true, 'active': currentSection === SelectionType.Owner}">
                        <button *ngIf="constitution.owner === currentUser.uid" mat-button class="nav-link waves-light" (click)="changeCurrentSection(SelectionType.Owner)"> Présidence </button>
                    </li>
                    <li [ngClass]="{'nav-item': true, 'active': currentSection === SelectionType.Result}">
                        <button mat-button class="nav-link waves-light" (click)="changeCurrentSection(SelectionType.Result)"> Resultats </button>
                    </li>
                    <li [ngClass]="{'nav-item': true, 'active': currentSection === SelectionType.Export}">
                        <button mat-button class="nav-link waves-light" (click)="changeCurrentSection(SelectionType.Export)"> Exporter </button>
                    </li>
                </ul>
            </links>
        </mdb-navbar>
        <br>
        <!-- Table Song List-->
        <table *ngIf="currentSection === SelectionType.SongList" id="t01">
            <tr>
                <th> Index </th>
                <th> Titre </th>
                <th> Auteur </th>
                <th> URL </th>
                <th> Ajouté par </th>
            </tr>
            <tr *ngFor="let song of constitution.songs">
                <td> {{song.id}} </td>
                <td> <button mat-stroked-button class="song-name" (click)="openDialogSong(song)"> {{song.shortTitle}} </button> </td>
                <td> {{song.author}} </td>
                <td> 
                    <a href="{{song.url}}"> {{song.url}} </a>
                </td>
                <td> {{showDisplayName(song.patron)}} </td>
            </tr>
        </table>
        <!-- Vote List -->
        <table *ngIf="currentSection === SelectionType.Vote" id="t01">
            <tr>
                <th> Index </th>
                <th> Titre </th>
                <th> URL </th>
                <th> Note </th>
            </tr>
            <tr *ngFor="let song of constitution.songs">
                <td> {{song.id}} </td>
                <td> <button mat-stroked-button class="song-name" (click)="openDialogSong(song)"> {{song.shortTitle}} </button> </td>
                <td> 
                    <a href="{{song.url}}"> {{song.url}} </a>
                </td>
                <td *ngIf="currentUser.uid === song.patron"> / </td>
                <td *ngIf="(currentUser.uid !== song.patron && returnVote(song) !== -1)"> {{returnVote(song)+1}} </td>
                <td *ngIf="(currentUser.uid !== song.patron && returnVote(song) === -1)"> </td>
            </tr>
        </table>
        <!-- Owner Info -->
        <div *ngIf="showOwnerInfo()">
            <h3> Statistiques </h3> 
            <span class="custom-br"></span>
            <br>
            <li> Saison {{constitution.season}} - Partie {{constitution.round}} </li>
            <li> Nombre de participant : {{constitution.users.length}}/{{constitution.numberMaxOfUser}} </li>
            <li> Nombre de Vote : {{votes.length}}/{{constitution.numberOfSongsPerUser * constitution.numberMaxOfUser * (constitution.numberMaxOfUser - 1)}} </li>
            <br>
            <h3> Options </h3> 
            <span class="custom-br"></span>
            <br>
            <button mat-raised-button color="primary" class="nav-link waves-light"> Bloquer {{constitution.name}} </button>
            <br>
            <button mat-raised-button color="primary" class="nav-link waves-light"> Publier les résultats </button>
            <br>
            <button mat-raised-button color="primary" class="nav-link waves-light"> Terminer {{constitution.name}} </button>
            <button mat-raised-button color="primary" class="nav-link waves-light"> Supprimer {{constitution.name}} </button>
        </div>
        <!-- Result Info -->
        <div *ngIf="currentSection === SelectionType.Result">
            <h4> Mes Résultats </h4>
            <span class="custom-br"></span>
            <br>
            <li> Moyenne de mes votes : {{userMeanVotes(currentUser.uid).toFixed(2)}} </li>
            <li> Moyenne de mes chansons : {{userMeanSongs(currentUser.uid).toFixed(2)}}</li>
            <br>
            <h4> Résultats Globaux </h4>
            <span class="custom-br"></span>
            <br>
            Moyenne des utilisateurs entre eux :
            <table id="t01">
                <tr>
                    <th> Utilisateur </th>
                    <th *ngFor="let user of users"> {{user.displayName}} </th>
                </tr>
                <tr *ngFor="let user of users">
                    <td style="background-color: #2E2E2E"> {{user.displayName}} </td>
                    <td *ngFor="let user2 of users"> 
                        <span *ngIf="user.uid === user2.uid"> / </span>
                        <span *ngIf="user.uid !== user2.uid"> {{userMeanUser(user2.uid, user.uid).toFixed(2)}} </span>
                    </td>
                </tr>
            </table>
            <br>
            Classement globale chansons :
            <table id="t01">
                <tr>
                    <th> Index </th>
                    <th> Titre </th>
                    <th> Auteur </th>
                    <th> URL </th>
                    <th> Score </th>
                    <th> Ajouté par </th>
                </tr>
            </table>
        </div>
    </div>
</div>

<!-- If not ready-->
<div *ngIf="isUserLoading || isConstitutionLoading">
    Page en cours de chargement...
</div>
