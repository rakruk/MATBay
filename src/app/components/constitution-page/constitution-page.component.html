<!-- Content -->
<div *ngIf="!(isUserLoading || isConstitutionLoading)">
    <mat-sidenav-container class="sidenav">
        <div>
            <h4> 
                <a *ngIf="constitution.youtubePlaylistID !== ''" href="https://youtube.com/playlist?list={{constitution.youtubePlaylistID}}" target="_blank"> {{constitution.name}} </a>
                <span *ngIf="constitution.youtubePlaylistID === ''"> {{constitution.name}} </span>
            </h4>
            <span class="custom-br"></span>
            <div *ngIf="constitution.songs?.length == 0"> Aucune chanson </div>
            <div *ngIf="constitution.songs?.length == 1"> {{constitution.songs.length}} chanson </div>
            <div *ngIf="constitution.songs?.length > 1"> {{constitution.songs.length}} chansons </div>
            Vous avez:
            {{numberOfSongsOfUser(currentUser.uid)}} / {{constitution.numberOfSongsPerUser}} chansons
            <br>
            <br>
            Membres :
            <div *ngFor="let user of users">
                <img class="picture" [src]="user.photoURL" [alt]="user.displayName">
                <span *ngIf="user.uid === constitution.owner" class="owner"> [Président] </span>
                {{user.displayName}}
                <br>
            </div>
            <span class="custom-br"></span>
            <br>
            <button mat-raised-button color="primary" (click)="openDialogManageSongs()"> Gérer mes chansons </button>
            <br>
            <br>
            <button mat-stroked-button [disabled]="currentUser.uid === constitution.owner" color="warn" (click)="leaveConstitution()"> Quitter la constitution </button>
            <br>
            <span *ngIf="currentUser.uid === constitution.owner" class="warning"> Vous ne pouvez pas quitter votre constitution </span>
        </div>
    </mat-sidenav-container>
    
    <div class="content">
        <!-- Navbar -->
        <mdb-navbar SideClass="navbar navbar-expand-lg navbar-dark elegant-color-dark lighten-1" [containerInside]="false">
            <!-- Navbar brand -->
            <mdb-navbar-brand><a class="navbar-brand" routerLink="/"></a></mdb-navbar-brand>
            <links>
                <!-- Links -->
                <ul class="navbar-nav mr-auto">
                    <li [ngClass]="{'nav-item': true, 'active': currentSection === SelectionType.SongList}">
                        <button mat-button class="nav-link waves-light" (click)="changeCurrentSection(SelectionType.SongList)"> Liste Chansons </button>
                    </li>
                    <li [ngClass]="{'nav-item': true, 'active': currentSection === SelectionType.Vote}">
                        <button mat-button class="nav-link waves-light" (click)="changeCurrentSection(SelectionType.Vote)"> Zone Électorale </button>
                    </li>
                    <li [ngClass]="{'nav-item': true, 'active': currentSection === SelectionType.Owner}">
                        <button *ngIf="constitution.owner === currentUser.uid" mat-button class="nav-link waves-light" (click)="changeCurrentSection(SelectionType.Owner)"> Présidence </button>
                    </li>
                    <li [ngClass]="{'nav-item': true, 'active': currentSection === SelectionType.Result}">
                        <button mat-button class="nav-link waves-light" (click)="changeCurrentSection(SelectionType.Result)"> Resultats </button>
                    </li>
                    <li [ngClass]="{'nav-item': true, 'active': currentSection === SelectionType.Export}">
                        <button mat-button class="nav-link waves-light" (click)="changeCurrentSection(SelectionType.Export)"> Exporter </button>
                    </li>
                </ul>
            </links>
        </mdb-navbar>
        <br>

        <!-- Song List-->
        <app-song-list-section *ngIf="currentSection === SelectionType.SongList" 
            [constitution]="constitution" [users]="users" [currentUser]="currentUser" [currentSection]="currentSection" [votes]="votes"> 
        </app-song-list-section>

        <!-- Vote List -->
        <app-vote-list-section *ngIf="currentSection === SelectionType.Vote"
            [constitution]="constitution" [users]="users" [currentUser]="currentUser" [currentSection]="currentSection" [votes]="votes">
        </app-vote-list-section>

        <!-- Owner Info -->
        <div *ngIf="showOwnerInfo()">
            <h3> Statistiques </h3> 
            <span class="custom-br"></span>
            <br>
            <li> Saison {{constitution.season}} - Partie {{constitution.round}} </li>
            <li> ID : {{constitution.id}} </li>
            <br>
            <li> Nombre de participants : {{constitution.users.length}}/{{constitution.numberMaxOfUser}} </li>
            <li> Nombre de chansons : {{constitution.songs.length}}/{{constitution.numberOfSongsPerUser * constitution.numberMaxOfUser}}</li>
            <li> Nombre de votes : {{votes.length}}/{{constitution.numberOfSongsPerUser * constitution.numberMaxOfUser * (constitution.numberMaxOfUser - 1)}} </li>
            <br>
            <h3> Options </h3> 
            <span class="custom-br"></span>
            <br>
            <li>
                <span *ngIf="!constitution.isLocked">
                    <button mat-raised-button [disabled]="!canLockSongList()" color="primary" class="nav-link waves-light" (click)="changeLockStatus(true)"> Vérouiller {{constitution.name}} </button>
                    - Empêcher la modification de la liste de chansons.
                </span>
                <span *ngIf="constitution.isLocked">
                    <button mat-raised-button color="primary" [disabled]="!canLockSongList()" class="nav-link waves-light" (click)="changeLockStatus(false)"> Dévérouiller {{constitution.name}} </button>
                    - Permet la modification de la liste de chansons.
                </span>
                <span *ngIf="!canLockSongList()" class="warning"> (Il manque des chansons) </span>
            </li>
            <br>
            <li>
                <span *ngIf="!constitution.isShowingResult">
                    <button mat-raised-button [disabled]="!canPublishResults()" color="primary" class="nav-link waves-light" (click)="changeResultsStatus(true)"> Publier les résultats </button>
                    - Afficher les résultats de la Constitution.
                </span>
                <span *ngIf="constitution.isShowingResult">
                    <button mat-raised-button [disabled]="!canPublishResults()" color="primary" class="nav-link waves-light" (click)="changeResultsStatus(false)"> Cacher les résultats </button>
                    - Cacher les résultats de la Constitution.
                </span>
                <span *ngIf="!canPublishResults()" class="warning"> (Toutes les chansons doivent être votés) </span>
            </li>
            <br>
            <li>
                <button mat-raised-button [disabled]="!canFinishConstitution()" color="primary" class="nav-link waves-light" (click)="finishConstitution()"> Terminer {{constitution.name}} </button>
                - Archiver la Constiution dans l'historique des Constitutions. Elle sera supprimée.
                <span *ngIf="!canFinishConstitution()" class="warning"> (Les résultats doivent être publiés) </span>
            </li>
            <br>
            <li>
                <button mat-raised-button color="primary" class="nav-link waves-light" (click)="deleteConstitution()"> Supprimer {{constitution.name}} </button>
                - Attention : les données seront perdus à jamais.
            </li>
        </div>

        <!-- Result Info -->
        <div *ngIf="currentSection === SelectionType.Result">
            <!-- <button mat-raised-button color="primary" class="nav-link waves-light" (click)="changeResultsStatus(true)"> Publier les résultats </button>
            <button mat-raised-button color="primary" class="nav-link waves-light" (click)="changeResultsStatus(false)"> Cacher les résultats </button>-->
            <h4> Mes Résultats </h4>
            <span class="custom-br"></span>
            <br>
            <li> Moyenne de mes votes : {{userMeanVotes(currentUser.uid).toFixed(2)}} </li>
            <li> Moyenne de mes chansons : 
                <span *ngIf="constitution.isShowingResult"> {{userMeanSongs(currentUser.uid).toFixed(2)}} </span>
                <span *ngIf="!constitution.isShowingResult" class="warning"> Coming Soon </span>
            </li>
            <br>
            <h4> Résultats Globaux </h4>
            <span class="custom-br"></span>
            <br>
            Moyenne des utilisateurs entre eux :
            <span *ngIf="!constitution.isShowingResult" class="warning"> Coming Soon </span>
            <table *ngIf="constitution.isShowingResult" id="t01">
                <tr>
                    <th> Utilisateur </th>
                    <th *ngFor="let user of users"> {{user.displayName}} </th>
                </tr>
                <tr *ngFor="let user of users">
                    <td style="background-color: #2E2E2E;"> {{user.displayName}} </td>
                    <td *ngFor="let user2 of users"> 
                        <span *ngIf="user.uid === user2.uid"> / </span>
                        <span *ngIf="user.uid !== user2.uid"> {{userMeanUser(user2.uid, user.uid).toFixed(2)}} </span>
                    </td>
                </tr>
            </table>
            <br>
            Classement globale chansons :
            <span *ngIf="!constitution.isShowingResult" class="warning"> Coming Soon </span>
            <table matSort (matSortChange)="sortDataResult($event)" *ngIf="constitution.isShowingResult" id="t01" >
                <tr>
                    <th mat-sort-header="id" > ID </th>
                    <th mat-sort-header="title"> Titre </th>
                    <th mat-sort-header="author"> Auteur </th>
                    <th> URL </th>
                    <th mat-sort-header="score"> Score </th>
                    <th mat-sort-header="user"> Ajouté par </th>
                </tr>
                <tr *ngFor="let result of results">
                    <td> {{result.songID}} </td>
                    <td> {{result.title}} </td>
                    <td> {{result.author}} </td>
                    <td>
                        <a href="{{result.url}}" target="_blank"> {{result.url}} </a>
                    </td>
                    <td> {{result.score.toFixed(2)}} </td>
                    <td> {{showDisplayName(result.userID)}} </td>
                </tr>
            </table>
        </div>
        
        <!-- Export Option -->
        <app-export-section *ngIf="currentSection === SelectionType.Export" [constitution]="constitution" [users]="users"> </app-export-section>
    </div>
</div>

<!-- If not ready-->
<div *ngIf="isUserLoading || isConstitutionLoading">
    Page en cours de chargement...
</div>
